<% 
  owner = current_user_owns?(conference_session)
  presentations_in_parts = conference_session.presentations_in_parts
  schedules_in_parts = conference_session.schedules.inject({}) {|res, s| res[s.part] = s; res}
  organizers = conference_session.organizers.includes(:user).order('users.surname').all 
  missing_presentations = conference_session.is_a?(Minisymposium) && ((! conference_session.accepted) and owner and (presentations[1].size < 4))
  condensed ||= false
%>  

<div class="conference_session_panel <%= 'condensed_panel' if condensed %>" id="<%= html_id(conference_session) %>">
  <%= panel_heading(conference_session) %>  

  <div class="panel-body">
    <p class="description"><%= conference_session.description %></p>

    <% presentations_in_parts.each do |part, presentations| %>
      <div <%= raw 'class="alert alert-warning"' if part == @highlight_part %>>
        <span><%= raw (conference_session.parts > 1) ? "<strong>PART #{part.to_i}</strong> " : "&nbsp;" %></span>
        <span class='pull-right'><%= icon('calendar') + (schedules_in_parts[part] || I18n.t(:schedule_to_be_decided)) %></span>
      </div>
      <%= list_presentations(presentations, conference_session) %>
    <% end %>

    <dl class="dl-horizontal">
      <dt><%= conference_session.organizers_label %>:</dt>
      <% organizers.each do |organizer| %>  
        <dd>
          <%= show_role(organizer) %>
          <%= link_to_delete organizer_path(organizer) if (owner and organizer.user != current_user) %>  
        </dd>
      <% end %>
    </dl>

    <%= render(partial: 'ratings/dl_list', locals: { what: conference_session }) %>  

    <dl class="dl-horizontal">
      <dt><%= t 'Tags' %>:</dt>
      <dd><%= conference_session.all_tags %></dd>
    </dl>

    <%= missing_presentations_alert if missing_presentations %>  
  </div>

  <div class="panel-footer footer-actions">
    <%= panel_actions(conference_session) %>  
  </div>
</div>

